{% with current=request.resolver_match.url_name %}
  <aside class="analytics-sidebar rounded-3xl border border-[color:var(--admin-border)] bg-[color:var(--admin-surface)] p-5 shadow-sm">
    <div class="flex items-center justify-between">
      <div class="analytics-sidebar-content text-xs font-semibold uppercase tracking-[0.2em] text-[color:var(--admin-muted)]">
        Analytics
      </div>
      <button
        type="button"
        class="analytics-sidebar-toggle flex h-8 w-8 items-center justify-center rounded-full border border-[color:var(--admin-border)] text-xs font-semibold text-[color:var(--admin-ink)] transition hover:bg-[color:var(--admin-bg)]"
        aria-label="Collapse sidebar"
        aria-expanded="true"
        title="Collapse sidebar"
      >
        <span class="toggle-icon" aria-hidden="true">&lsaquo;</span>
      </button>
    </div>
    <nav class="analytics-sidebar-content mt-4 flex flex-col gap-2 text-sm font-semibold">
      <a
        href="{% url 'site_admin:analytics_dashboard' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'analytics_dashboard' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        Overview
      </a>
      <a
        href="{% url 'site_admin:analytics_user_agents' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'analytics_user_agents' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        User agents
      </a>
      <a
        href="{% url 'site_admin:analytics_bot_detection' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'analytics_bot_detection' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        Bot detection
      </a>
      <a
        href="{% url 'site_admin:analytics_ignored_user_agents' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'analytics_ignored_user_agents' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        Ignored user agents
      </a>
      <a
        href="{% url 'site_admin:analytics_errors_by_user_agent' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'analytics_errors_by_user_agent' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        Errors by user agent
      </a>
      <a
        href="{% url 'site_admin:redirect_list' %}"
        class="rounded-2xl px-4 py-2 transition {% if current == 'redirect_list' or current == 'redirect_create' or current == 'redirect_edit' or current == 'redirect_delete' %}bg-[color:var(--admin-bg)] text-[color:var(--admin-ink)]{% else %}text-[color:var(--admin-muted)] hover:bg-[color:var(--admin-bg)] hover:text-[color:var(--admin-ink)]{% endif %}"
      >
        Redirects
      </a>
    </nav>
  </aside>
  <style>
    @media (min-width: 1024px) {
      .analytics-layout.is-sidebar-collapsed {
        grid-template-columns: 56px 1fr;
      }
    }

    .analytics-layout.is-sidebar-collapsed .analytics-sidebar {
      padding: 1rem;
    }

    .analytics-layout.is-sidebar-collapsed .analytics-sidebar .analytics-sidebar-content {
      display: none;
    }
  </style>
  <script>
    (() => {
      const layout = document.querySelector(".analytics-layout");
      if (!layout) return;
      const toggle = layout.querySelector(".analytics-sidebar-toggle");
      if (!toggle) return;
      const storageKey = "analytics-sidebar-collapsed";
      const icon = layout.querySelector(".toggle-icon");
      const applyState = (collapsed) => {
        layout.classList.toggle("is-sidebar-collapsed", collapsed);
        if (!icon) return;
        icon.innerHTML = collapsed ? "&rsaquo;" : "&lsaquo;";
        toggle.setAttribute("aria-label", collapsed ? "Expand sidebar" : "Collapse sidebar");
        toggle.setAttribute("aria-expanded", collapsed ? "false" : "true");
        toggle.setAttribute("title", collapsed ? "Expand sidebar" : "Collapse sidebar");
      };
      const stored = localStorage.getItem(storageKey) === "1";
      applyState(stored);
      toggle.addEventListener("click", () => {
        const next = !layout.classList.contains("is-sidebar-collapsed");
        localStorage.setItem(storageKey, next ? "1" : "0");
        applyState(next);
      });
    })();
  </script>
{% endwith %}
