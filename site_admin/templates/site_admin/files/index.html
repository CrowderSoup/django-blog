{% extends "site_admin/base.html" %}

{% block title %}Files{% endblock %}

{% block content %}
  <div class="flex flex-col gap-6">
    <section class="flex flex-wrap items-start justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold">Files</h1>
        <p class="mt-1 text-sm text-[color:var(--admin-muted)]">Browse uploads and grab URLs quickly.</p>
      </div>
      <a
        href="{% url 'site_admin:file_create' %}"
        class="rounded-full bg-[color:var(--admin-accent)] px-4 py-2 text-sm font-semibold text-white transition hover:bg-[color:var(--admin-accent-strong)]"
      >
        Upload file
      </a>
    </section>

    <section class="rounded-3xl border border-[color:var(--admin-border)] bg-[color:var(--admin-surface)] p-6 shadow-sm">
      {% if page_obj.object_list %}
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {% for asset in page_obj.object_list %}
            <div class="overflow-hidden rounded-2xl border border-[color:var(--admin-border)] bg-white">
              <a href="{{ asset.file.url }}" class="block" target="_blank" rel="noopener">
                {% if asset.kind == "image" %}
                  <img
                    src="{{ asset.file.url }}"
                    alt="{{ asset.alt_text|default:asset }}"
                    class="h-40 w-full object-cover"
                    loading="lazy"
                  />
                {% else %}
                  <div class="flex h-40 items-center justify-center bg-[color:var(--admin-bg)]">
                    <span class="rounded-full border border-[color:var(--admin-border)] px-3 py-1 text-xs font-semibold uppercase tracking-wide text-[color:var(--admin-muted)]">
                      {{ asset.get_kind_display }}
                    </span>
                  </div>
                {% endif %}
              </a>
              <div class="p-4">
                <div class="truncate text-sm font-semibold" title="{{ asset.caption|default:asset.alt_text|default:asset }}">
                  {{ asset.caption|default:asset.alt_text|default:asset }}
                </div>
                <div class="mt-1 flex items-center justify-between text-xs text-[color:var(--admin-muted)]">
                  <span>{{ asset.get_kind_display }}</span>
                  <span>{{ asset.created_at|date:"M j, Y" }}</span>
                </div>
                <div class="mt-3 flex items-center justify-between text-xs">
                  <a
                    href="{% url 'site_admin:file_edit' file_id=asset.id %}"
                    class="font-semibold text-[color:var(--admin-accent)]"
                  >
                    Edit details
                  </a>
                  <a href="{{ asset.file.url }}" class="text-[color:var(--admin-muted)]" target="_blank" rel="noopener">
                    Open file
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="mt-6 flex flex-wrap items-center justify-between gap-3 text-sm">
          <div class="text-[color:var(--admin-muted)]">
            Page {{ page_obj.number }} of {{ paginator.num_pages }}
          </div>
          <div class="flex items-center gap-2">
            {% if page_obj.has_previous %}
              <a
                href="?page={{ page_obj.previous_page_number }}{% if base_query %}&{{ base_query }}{% endif %}"
                class="rounded-full border border-[color:var(--admin-border)] px-3 py-1.5 font-semibold text-[color:var(--admin-ink)] transition hover:bg-[color:var(--admin-bg)]"
              >
                Previous
              </a>
            {% endif %}
            {% if page_obj.has_next %}
              <a
                href="?page={{ page_obj.next_page_number }}{% if base_query %}&{{ base_query }}{% endif %}"
                class="rounded-full border border-[color:var(--admin-border)] px-3 py-1.5 font-semibold text-[color:var(--admin-ink)] transition hover:bg-[color:var(--admin-bg)]"
              >
                Next
              </a>
            {% endif %}
          </div>
        </div>
      {% else %}
        <div class="rounded-2xl border border-dashed border-[color:var(--admin-border)] p-6 text-sm text-[color:var(--admin-muted)]">
          No files uploaded yet.
        </div>
      {% endif %}
    </section>
  </div>
{% endblock %}
