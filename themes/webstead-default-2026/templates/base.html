{% load static author %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ settings.title }}{% block title %}{% endblock %}</title>
    {% if settings.favicon_id %}
    <link rel="icon" href="{{ settings.favicon.file.url }}" />
    {% else %}
    <link rel="icon" href="{% static 'favicon.svg' %}" />
    {% endif %}

    {# Theme assets live at themes/<slug>/... #}
    <link rel="stylesheet" href="{% theme_static 'css/theme.css' %}" />
    <link rel="stylesheet" href="{% theme_static 'css/print.css' %}" media="print" />

    {# RSS feed (only present on pages where feed_url is provided) #}
    {% if feed_url %}
    <link rel="alternate" type="application/rss+xml" href="{{ feed_url }}" title="{{ settings.title }} RSS" />
    {% endif %}

    {# IndieWeb endpoints for auth, Micropub, and Webmention #}
    <link rel="indieauth-metadata" href="{% url 'indieauth-metadata' %}">
    <link rel="authorization_endpoint" href="{% url 'indieauth-authorize' %}">
    <link rel="token_endpoint" href="{% url 'indieauth-token' %}">
    <link rel="microsub" href="https://aperture.p3k.io/microsub/205">
    <link rel="micropub" href="{% url 'micropub-endpoint' %}">
    <link rel="webmention" href="{% url 'webmention-endpoint' %}">

    {# Analytics beacon uses the visit-id meta tag #}
    <meta name="visit-id" content="{{ request.visit_id }}">
    <script src="{% static 'analytics/beacon.js' %}"></script>

    {% with og_title=og_title|default:settings.title og_description=og_description|default:settings.tagline og_image=og_image|default:og_default_image og_url=og_url|default:request.build_absolute_uri og_type=og_type|default:"website" og_image_alt=og_image_alt|default:settings.title %}
    <meta property="og:site_name" content="{{ settings.title }}">
    <meta property="og:title" content="{{ og_title }}">
    <meta property="og:description" content="{{ og_description }}">
    <meta property="og:type" content="{{ og_type }}">
    <meta property="og:url" content="{{ og_url }}">
    {% if og_image %}
    <meta property="og:image" content="{{ og_image }}">
    <meta property="og:image:alt" content="{{ og_image_alt }}">
    {% endif %}
    <meta name="twitter:card" content="{% if og_image %}summary_large_image{% else %}summary{% endif %}">
    <meta name="twitter:title" content="{{ og_title }}">
    <meta name="twitter:description" content="{{ og_description }}">
    {% if og_image %}
    <meta name="twitter:image" content="{{ og_image }}">
    {% endif %}
    {% endwith %}

    {% block head %}{% endblock %}
  </head>
  <body class="theme-webstead" data-site-admin-bar-url="{% url 'site_admin:admin_bar' %}">
    <a class="skip-link" href="#content">Skip to content</a>

    <header class="site-header">
      <div class="site-title">
        <a href="/" rel="home">{{ settings.title }}</a>
      </div>

      {% if not hide_site_description %}
      <p class="site-tagline">{{ settings.tagline }}</p>
      {% endif %}

      {% if not hide_nav %}
      <nav class="site-nav" aria-label="Main navigation">
        {% for item in menu_items %}
        <a href="{{ item.url }}">{{ item.text }}</a>
        {% endfor %}
      </nav>
      {% endif %}
    </header>

    <main id="content" class="site-main">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <div class="footer-meta">
        <span>Â© {{ now|date:"Y" }}</span>
        <a href="{% static 'pubkey.txt' %}" rel="me pgpkey">{% author_hcard_name %}</a>
      </div>

      {% if footer_menu_items %}
      <nav class="footer-nav" aria-label="Footer navigation">
        {% for item in footer_menu_items %}
        <a href="{{ item.url }}">{{ item.text }}</a>
        {% endfor %}
      </nav>
      {% endif %}

      {% block footer_extra %}
      {% endblock %}
    </footer>

    <script src="{% theme_static 'js/theme.js' %}"></script>
    <script src="{% static 'js/site_admin_bar.js' %}"></script>
  </body>
</html>
