{% load static author %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ settings.title }}{% block title %}{% endblock %}</title>
    {% if settings.favicon_id %}
    <link rel="icon" href="{{ settings.favicon.file.url }}" />
    {% else %}
    <link rel="icon" href="{% static 'favicon.svg' %}" />
    {% endif %}

    {# Theme assets live at themes/<slug>/... #}
    <link rel="stylesheet" href="{% theme_static 'css/theme.css' %}" />
    <link rel="stylesheet" href="{% theme_static 'css/print.css' %}" media="print" />
    <style>
      :root {
        --ink: {{ theme.settings.ink_color|default:"#161413" }};
        --muted: {{ theme.settings.muted_color|default:"#5a605f" }};
        --inverse-text: {{ theme.settings.inverse_text_color|default:"#ffffff" }};
        --paper: {{ theme.settings.paper_color|default:"#f6f2ea" }};
        --panel: {{ theme.settings.panel_color|default:"#ffffff" }};
        --surface-cream: {{ theme.settings.surface_cream_color|default:"#fffdf9" }};
        --surface-warm: {{ theme.settings.surface_warm_color|default:"#f3eee5" }};
        --surface-accent-soft: {{ theme.settings.surface_accent_soft_color|default:"#fff4e8" }};
        --surface-accent-soft-alt: {{ theme.settings.surface_accent_soft_alt_color|default:"#fff3e6" }};
        --surface-accent-hover: {{ theme.settings.surface_accent_hover_color|default:"#ffe6cc" }};
        --activity-surface: {{ theme.settings.activity_surface_color|default:"#fff9f1" }};
        --activity-border: {{ theme.settings.activity_border_color|default:"#e8ddcd" }};
        --interaction-surface: {{ theme.settings.interaction_surface_color|default:"#f9f5ef" }};
        --map-surface: {{ theme.settings.map_surface_color|default:"#f3ede2" }};
        --photo-dark: {{ theme.settings.photo_dark_color|default:"#0f0f0f" }};
        --accent: {{ theme.settings.accent_color|default:"#d56b30" }};
        --accent-deep: {{ theme.settings.accent_deep_color|default:"#9a4c2b" }};
        --line: {{ theme.settings.line_color|default:"#ded8cd" }};
        --shadow: {{ theme.settings.shadow_color|default:"rgba(22, 20, 19, 0.08)" }};
        --accent-shadow: {{ theme.settings.accent_shadow_color|default:"rgba(213, 107, 48, 0.18)" }};
        --accent-shadow-strong: {{ theme.settings.accent_shadow_strong_color|default:"rgba(154, 76, 43, 0.2)" }};
        --interaction-shadow: {{ theme.settings.interaction_shadow_color|default:"rgba(68, 41, 6, 0.08)" }};
        --input-shadow: {{ theme.settings.input_shadow_color|default:"rgba(22, 20, 19, 0.04)" }};
        --focus-shadow: {{ theme.settings.focus_shadow_color|default:"rgba(213, 107, 48, 0.15)" }};
        --scrollbar-shadow: {{ theme.settings.scrollbar_shadow_color|default:"rgba(22, 20, 19, 0.25)" }};
        --glass-light: {{ theme.settings.glass_light_color|default:"rgba(255, 255, 255, 0.6)" }};
        --glass-lighter: {{ theme.settings.glass_lighter_color|default:"rgba(255, 255, 255, 0.7)" }};
        --photo-dot: {{ theme.settings.photo_dot_color|default:"rgba(0, 0, 0, 0.18)" }};
        --photo-dot-active: {{ theme.settings.photo_dot_active_color|default:"rgba(0, 0, 0, 0.6)" }};
        --site-admin-bar-bg: {{ theme.settings.admin_bar_bg_color|default:"#f5efe6" }};
        --site-admin-bar-hamburger-bg: {{ theme.settings.admin_bar_hamburger_color|default:"#6b6a69" }};
        --bg-start: {{ theme.settings.background_gradient_start|default:"#f5efe6" }};
        --bg-mid: {{ theme.settings.background_gradient_mid|default:"#f8f4ee" }};
        --bg-end: {{ theme.settings.background_gradient_end|default:"#fbfaf7" }};
        --bg-pattern: {% if theme.settings.show_background_pattern|default:true %}url("{% theme_static 'img/pattern.svg' %}"){% else %}none{% endif %};
        --font-body: {{ theme.settings.font_body|default:"\"IBM Plex Sans\", \"Avenir\", \"Trebuchet MS\", sans-serif"|safe }};
        --font-heading: {{ theme.settings.font_heading|default:"\"Fraunces\", \"Iowan Old Style\", \"Palatino\", serif"|safe }};
        --font-mono: {{ theme.settings.font_mono|default:"\"IBM Plex Mono\", \"Menlo\", \"Consolas\", \"Courier New\", monospace"|safe }};
        --radius-sm: {{ theme.settings.radius_sm|default:"12px" }};
        --radius-md: {{ theme.settings.radius_md|default:"16px" }};
        --radius-lg: {{ theme.settings.radius_lg|default:"20px" }};
        --radius-xl: {{ theme.settings.radius_xl|default:"24px" }};
        --radius-pill: {{ theme.settings.radius_pill|default:"999px" }};
      }
    </style>

    {# RSS feed (only present on pages where feed_url is provided) #}
    {% if feed_url %}
    <link rel="alternate" type="application/rss+xml" href="{{ feed_url }}" title="{{ settings.title }} RSS" />
    {% endif %}

    {# IndieWeb endpoints for auth, Micropub, and Webmention #}
    <link rel="indieauth-metadata" href="{% url 'indieauth-metadata' %}">
    <link rel="authorization_endpoint" href="{% url 'indieauth-authorize' %}">
    <link rel="token_endpoint" href="{% url 'indieauth-token' %}">
    <link rel="microsub" href="https://aperture.p3k.io/microsub/205">
    <link rel="micropub" href="{% url 'micropub-endpoint' %}">
    <link rel="webmention" href="{% url 'webmention-endpoint' %}">

    {# Analytics beacon uses the visit-id meta tag #}
    <meta name="visit-id" content="{{ request.visit_id }}">
    <script src="{% static 'analytics/beacon.js' %}"></script>

    {% with og_title=og_title|default:settings.title og_description=og_description|default:settings.tagline og_image=og_image|default:og_default_image og_url=og_url|default:request.build_absolute_uri og_type=og_type|default:"website" og_image_alt=og_image_alt|default:settings.title %}
    <meta property="og:site_name" content="{{ settings.title }}">
    <meta property="og:title" content="{{ og_title }}">
    <meta property="og:description" content="{{ og_description }}">
    <meta property="og:type" content="{{ og_type }}">
    <meta property="og:url" content="{{ og_url }}">
    {% if og_image %}
    <meta property="og:image" content="{{ og_image }}">
    <meta property="og:image:alt" content="{{ og_image_alt }}">
    {% endif %}
    <meta name="twitter:card" content="{% if og_image %}summary_large_image{% else %}summary{% endif %}">
    <meta name="twitter:title" content="{{ og_title }}">
    <meta name="twitter:description" content="{{ og_description }}">
    {% if og_image %}
    <meta name="twitter:image" content="{{ og_image }}">
    {% endif %}
    {% endwith %}

    {% block head %}{% endblock %}
  </head>
  <body class="theme-webstead" data-site-admin-bar-url="{% url 'site_admin:admin_bar' %}">
    <a class="skip-link" href="#content">Skip to content</a>

    <header class="site-header">
      <div class="site-title">
        <a href="/" rel="home">{{ settings.title }}</a>
      </div>

      {% if not hide_site_description %}
      <p class="site-tagline">{{ settings.tagline }}</p>
      {% endif %}

      {% if not hide_nav %}
      <nav class="site-nav" aria-label="Main navigation">
        {% for item in menu_items %}
        <a href="{{ item.url }}">{{ item.text }}</a>
        {% endfor %}
      </nav>
      {% endif %}
    </header>

    <main id="content" class="site-main">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <div class="footer-meta">
        <span>Â© {{ now|date:"Y" }}</span>
        <a href="{% static 'pubkey.txt' %}" rel="me pgpkey">{% author_hcard_name %}</a>
      </div>

      {% if footer_menu_items %}
      <nav class="footer-nav" aria-label="Footer navigation">
        {% for item in footer_menu_items %}
        <a href="{{ item.url }}">{{ item.text }}</a>
        {% endfor %}
      </nav>
      {% endif %}

      {% block footer_extra %}
      {% endblock %}
    </footer>

    <script src="{% theme_static 'js/theme.js' %}"></script>
    <script src="{% static 'js/site_admin_bar.js' %}"></script>
  </body>
</html>
